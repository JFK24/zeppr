---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# R pacakge zeppr (Beta!)

<!-- badges: start -->
<!-- badges: end -->

The zeppr package for R provides a collection of functions to process plant 
protection data. It is actually made for a particular institute but it may be 
useful for more persons. 
It is a beta version provided AS IS without any guaranty or support. 
It is available for non-commercial use at your own risks. 
Contact me for commercial use.


## Installation

This package was developed using R 4.2.2. 
The library `devtools` is also required. 
You can install the development version of `zeppr` 
from [GitHub](https://github.com/) with:

``` r
# install.packages("devtools") # uncomment to install devtools if necessary 
devtools::install_github("JFK24/zeppr")
```

## Examples

### Normalized cumulative sum

```{r normalized_cumsum}
library(zeppr)
# cumulative sum without normalization
normalized_cumsum(c(1,2,3,4,5), normalize = FALSE)
# with normalization to the total sum (as percentage)
normalized_cumsum(c(1,2,3,4,5))
```


### Growing degree-days for vectors

Calculates the growing degree-days for pairs of min and max day temperatures. 
It is developed for daily data but can be used for hourly data with a 
few tricks.

#### For daily data

```{r}
# A simple example: the growing degree-days gdd = ((9+20)/2)-10 = 4.5
growing_degree_days(t.min=9, t.max=20, t.ceiling=30, t.base=10, use.floor=FALSE)
# If t.base is used as floor value: gdd = ((10+20)/2)-10 = 5
growing_degree_days(t.min=9, t.max=20, t.ceiling=30, t.base=10, use.floor=TRUE)
# If a floor and a ceiling temperature are used:  gdd = ((10+15)/2)-10 = 2.5
growing_degree_days(t.min=9, t.max=20, t.ceiling=15, t.base=10, use.floor=TRUE)
# Processes pairs of min max temperatures defined in 2 vectors of same length
growing_degree_days(c(7, 8, 10), c(12, 14, 15), t.ceiling=30, t.base=10, use.floor=FALSE)
```


#### Tricks for hourly data

* Hourly data tables have 1 row per hour and thus 24 rows per day.
* Each hour has only 1 temperature (no min and max day temperatures)
* Let us define growing degree-hours as the same than growing degree-days but 
applied for a single hour where the min and max temperatures are both equal to 
the temperature for this hour
* The degree-days for 1 day is equal to the sum of its 24 degree-hours 
  divided by 24. 

The following tricks are automatized by the `mutate_cumsum_gdd` function 
described below.
  
```{r}
# Let say we have 24 temperatures for a particular day
temperatures = c(1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 11, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0)
# We can get corresponding degree-hours above 5 degrees
gdh <- growing_degree_days(t.min=temperatures, t.max=temperatures, t.base=5)
print(gdh)
# the growing degree-days for this day is calculated as follows:
sum(gdh)/24
```


### Growing degree-days for data frames

Function `mutate_cumsum_gdd()` works on a data frame with date and temperature 
columns to return a copy of the data frame with an additional column for the 
cumulative sum of growing degree-days. 
The **input columns are assumed to be complete**:  no missing time points and no 
missing temperature values. 

#### For daily data

```{r}
# given a simple data.frame with date, min and max temperature
daily.table <- data.frame(
  Date=as.Date(c("2022-01-01", "2022-01-02", "2022-01-03")),
  Tmin=c(4, 6, 11),
  Tmax=c(12, 14, 20))
print(daily.table)
# we add a column containing growing degree-days as follows:
mutate_cumsum_gdd(daily.table, date=Date, t.min=Tmin, t.max=Tmax, 
                  t.ceiling=30, t.base=5, use.floor=FALSE, hourly.data=FALSE)
# With pipes from magrittr and custom column name:
library(magrittr)
daily.table %>% mutate_cumsum_gdd(Date, Tmin, Tmax, values_to="my_gdd")
```

#### For hourly data

```{r}
# given a simple data.frame with date.time and temperature (no min and max)
hourly.table <- data.frame(
  date.time=as.POSIXct(c("2022-01-01 13:00:00", "2022-01-02 14:00:00", "2022-01-03 15:00:00")),
  temperature=c(12, 14, 20)
)
print(hourly.table)
# we add a column containing growing degree-days by setting hourly.data to TRUE 
# and reusing hourly temperatures with t.min and t.mx parameters as follows:
mutate_cumsum_gdd(hourly.table, date=date.time, 
                  t.min=temperature, t.max=temperature, 
                  t.ceiling=30, t.base=5, use.floor=FALSE, hourly.data=TRUE)
# With pipes from magrittr and custom column name:
library(magrittr)
hourly.table %>% mutate_cumsum_gdd(date.time, temperature, temperature, hourly.data=TRUE, values_to="my_gdd")
```


### ISIP weather data processing

Functions to process weather data from the ISIP service. 

```{r}
# Read an ISIP Excel file of weather data:
# read_isip_hourly_weather_data()

# Add the cumulative sum of growing degree-days to an ISIP table:
# mutate_isip_weather_with_cumsum_gdd()
```
